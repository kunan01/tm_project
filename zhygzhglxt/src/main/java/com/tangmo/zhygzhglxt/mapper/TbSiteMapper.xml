<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.tangmo.zhygzhglxt.dao.TbSiteMapper">
    <resultMap id="BaseResultMap" type="com.tangmo.zhygzhglxt.entity.TbSite">
        <!--
          列匹配实体属性
        -->
        <id column="site_id" property="siteId" jdbcType="VARCHAR"/>
        <result column="site_code" property="siteCode" jdbcType="VARCHAR"/>
        <result column="site_name" property="siteName" jdbcType="VARCHAR"/>
        <result column="site_lo" property="siteLo" jdbcType="VARCHAR"/>
        <result column="site_la" property="siteLa" jdbcType="VARCHAR"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="update_time" property="updateTime" jdbcType="TIMESTAMP"/>
        <result column="flag" property="flag" jdbcType="VARCHAR"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          列名
        -->
        site_id, site_code, site_name, site_lo, site_la, create_time, update_time, flag
    </sql>

    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <include refid="Base_Column_List"/>
        from tb_site
        where site_id = #{siteId,jdbcType=VARCHAR}
    </select>

    <!--
          根据站点的唯一标识查询站点信息.
        -->
    <select id="getSiteByLoLa" resultMap="BaseResultMap">

        select
        site_id, site_code, site_name
        , ROUND(
        6378.138 * 2 * ASIN(
        SQRT(
        POW(
        SIN( ( #{NowLa,jdbcType=VARCHAR} * PI() / 180 - site_la * PI() / 180 ) / 2 ) , 2 )
        +
        COS( #{NowLa,jdbcType=VARCHAR} * PI( ) / 180 ) * COS( site_la * PI( ) / 180 )
        * POW( SIN( ( #{NowLo,jdbcType=VARCHAR} * PI() / 180 - site_lo * PI() / 180 ) / 2 ) , 2 )
        )
        ) * 1000
        ) AS distance
        from tb_site
        where site_code IN
        <foreach collection="siteCodes" open="(" close=")" item="item" index="index" separator=",">
            #{item}
        </foreach>
        and flag = "0"
        order by distance asc
        limit 0,1
    </select>

    <!--
          根据站点的唯一标识查询站点信息.
        -->
    <select id="selectBySiteCode" resultMap="BaseResultMap" parameterType="java.lang.String">

        select
        site_id, site_code, site_name, site_lo, site_la
        from tb_site
        where site_code = #{siteCode,jdbcType=VARCHAR}
        AND flag = "0"
    </select>

    <!--
          根据多个站点的唯一标识查询站点信息.
        -->
    <select id="selectBySiteCodes" resultMap="BaseResultMap">

        select
        site_id, site_code, site_name, site_lo, site_la
        from tb_site
        where site_code = #{siteCode}
        AND flag = "0"
    </select>


    <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from tb_site
        where site_id = #{siteId,jdbcType=VARCHAR}
    </delete>
    <insert id="insert" parameterType="com.tangmo.zhygzhglxt.entity.TbSite">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into tb_site (site_id, site_code, site_name,
        site_lo, site_la, create_time,
        update_time, flag)
        values (#{siteId,jdbcType=VARCHAR}, #{siteCode,jdbcType=VARCHAR}, #{siteName,jdbcType=VARCHAR},
        #{siteLo,jdbcType=VARCHAR}, #{siteLa,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP},
        #{updateTime,jdbcType=TIMESTAMP}, #{flag,jdbcType=VARCHAR})
    </insert>
    <insert id="insertSelective" parameterType="com.tangmo.zhygzhglxt.entity.TbSite">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into tb_site
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="siteId != null">
                site_id,
            </if>
            <if test="siteCode != null">
                site_code,
            </if>
            <if test="siteName != null">
                site_name,
            </if>
            <if test="siteLo != null">
                site_lo,
            </if>
            <if test="siteLa != null">
                site_la,
            </if>
            <if test="createTime != null">
                create_time,
            </if>
            <if test="updateTime != null">
                update_time,
            </if>
            <if test="flag != null">
                flag,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="siteId != null">
                #{siteId,jdbcType=VARCHAR},
            </if>
            <if test="siteCode != null">
                #{siteCode,jdbcType=VARCHAR},
            </if>
            <if test="siteName != null">
                #{siteName,jdbcType=VARCHAR},
            </if>
            <if test="siteLo != null">
                #{siteLo,jdbcType=VARCHAR},
            </if>
            <if test="siteLa != null">
                #{siteLa,jdbcType=VARCHAR},
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateTime != null">
                #{updateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="flag != null">
                #{flag,jdbcType=VARCHAR},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.tangmo.zhygzhglxt.entity.TbSite">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update tb_site
        <set>
            <if test="siteCode != null">
                site_code = #{siteCode,jdbcType=VARCHAR},
            </if>
            <if test="siteName != null">
                site_name = #{siteName,jdbcType=VARCHAR},
            </if>
            <if test="siteLo != null">
                site_lo = #{siteLo,jdbcType=VARCHAR},
            </if>
            <if test="siteLa != null">
                site_la = #{siteLa,jdbcType=VARCHAR},
            </if>
            <if test="createTime != null">
                create_time = #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateTime != null">
                update_time = #{updateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="flag != null">
                flag = #{flag,jdbcType=VARCHAR},
            </if>
        </set>
        where site_id = #{siteId,jdbcType=VARCHAR}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.tangmo.zhygzhglxt.entity.TbSite">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update tb_site
        set site_code = #{siteCode,jdbcType=VARCHAR},
        site_name = #{siteName,jdbcType=VARCHAR},
        site_lo = #{siteLo,jdbcType=VARCHAR},
        site_la = #{siteLa,jdbcType=VARCHAR},
        create_time = #{createTime,jdbcType=TIMESTAMP},
        update_time = #{updateTime,jdbcType=TIMESTAMP},
        flag = #{flag,jdbcType=VARCHAR}
        where site_id = #{siteId,jdbcType=VARCHAR}
    </update>
</mapper>